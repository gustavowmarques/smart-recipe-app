{% extends "core/base.html" %}
{% load static %}
{% block title %}Dashboard{% endblock %}

{% block content %}

<!-- Header -->
<div class="d-flex justify-content-between align-items-center mb-3">
  <h4 class="mb-0">Your Pantry</h4>
  <div class="form-check m-0">
    <input class="form-check-input" type="checkbox" id="selectAllPantry">
    <label class="form-check-label" for="selectAllPantry">Select all</label>
  </div>
</div>

<!-- Pantry table -->
<div class="card mb-4">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-sm table-striped mb-0 align-middle">
        <thead class="table-light">
          <tr>
            <th style="width:40px;"></th>
            <th>Ingredient</th>
            <th style="width:110px;">Qty</th>
            <th style="width:110px;">Unit</th>
            <th class="text-end" style="width:120px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for ing in ingredients %}
          <tr>
            <td>
              <input class="form-check-input pantry-check" type="checkbox" value="{{ ing.id }}" aria-label="Select {{ ing.name }}">
            </td>
            <td>{{ ing.name }}</td>
            <td>{{ ing.quantity|default:"—" }}</td>
            <td>{{ ing.unit|default:"—" }}</td>
            <td class="text-end">
              <form method="post" action="{% url 'delete_ingredient' ing.pk %}" class="d-inline">
                {% csrf_token %}
                <button class="btn btn-sm btn-outline-danger">Remove</button>
              </form>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="text-muted">No ingredients yet. Add one below.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Generate recipes -->
<div class="card mb-4">
  <div class="card-body">
    <form
      id="generateForm"
      method="post"
      data-selected-target="selectedIds"
      class="row g-2 align-items-end"
    >
      {% csrf_token %}
      <input type="hidden" name="selected_ids" id="selectedIds">

      <div class="col-auto">
        <label class="form-label mb-1 fw-semibold">Recipe type:</label>
        <select name="kind" class="form-select">
          <option value="food" selected>Food</option>
          <option value="drink">Drink</option>
        </select>
      </div>

      <div class="col-auto">
        <!-- Same form; different endpoints via formaction -->
        <button class="btn btn-success" formaction="{% url 'ai_recipes' %}">
          Get AI Recipes
        </button>
      </div>

      <div class="col-auto">
        <button class="btn btn-outline-primary" formaction="{% url 'web_recipes' %}">
          Search the Web
        </button>
      </div>

      <div class="col-12">
        <p class="text-muted small mb-0">
          Tip: tick ingredients above to use only those; leave unticked items out of generation.
        </p>
      </div>
    </form>
  </div>
</div>

<!-- Add ingredient -->
<div class="card">
  <div class="card-header">Add an ingredient</div>
  <div class="card-body">
    <form class="row g-2 align-items-end" method="post" action="{% url 'add_ingredient' %}">
      {% csrf_token %}
      <div class="col-md-6">
        <label class="form-label">Name</label>
        {{ form.name }}
      </div>
      <div class="col-md-3">
        <label class="form-label">Quantity</label>
        {{ form.quantity }}
      </div>
      <div class="col-md-3">
        <label class="form-label">Unit</label>
        {{ form.unit }}
      </div>
      <div class="col-12 col-md-auto">
        <button class="btn btn-primary mt-2 mt-md-4">Add</button>
      </div>
    </form>
  </div>
</div>

<!-- JS: collects selected IDs on submit & handles "select all" -->
<script src="{% static 'js/pantry-selection.js' %}"></script>
{% endblock %}
