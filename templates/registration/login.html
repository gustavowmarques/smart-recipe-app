{% extends "core/base.html" %}

{% block content %}
<div class="container" style="max-width: 520px;">
  <div class="card shadow-sm my-5">
    <div class="card-body p-4">
      <h1 class="h4 mb-3">Log in</h1>

      {% if form.non_field_errors %}
        <div class="alert alert-danger">{{ form.non_field_errors }}</div>
      {% endif %}

      <form method="post" action="{% url 'login' %}">
        {% csrf_token %}

        {# Render the default auth form safely #}
        {{ form.as_p }}

        {# Keep 'next' if present #}
        {% if next %}
          <input type="hidden" name="next" value="{{ next }}">
        {% endif %}

        <button type="submit" class="btn btn-primary w-100">Log in</button>
      </form>

      <hr class="my-4">

      {# ğŸ” Safe login URL resolution (for the â€œback to loginâ€ case if needed) #}
      {% url 'login' as login_url %}
      {% if not login_url %}{% url 'account_login' as login_url %}{% endif %}

      {# ğŸ“ Safe register URL resolution: try your app, then a plain 'register', then allauth #}
      {% url 'accounts:register' as register_url %}
      {% if not register_url %}{% url 'register' as register_url %}{% endif %}
      {% if not register_url %}{% url 'account_signup' as register_url %}{% endif %}

      {# ğŸ” Safe password reset URL (Django auth or allauth) #}
      {% url 'password_reset' as reset_url %}
      {% if not reset_url %}{% url 'account_reset_password' as reset_url %}{% endif %}

      <div class="d-flex flex-column gap-2 small">
        {% if register_url %}
          <div>No account? <a href="{{ register_url }}">Create one</a>.</div>
        {% endif %}
        {% if reset_url %}
          <div><a href="{{ reset_url }}">Forgot your password?</a></div>
        {% endif %}
        {% if login_url and not register_url and not reset_url %}
          <div class="text-muted">If you canâ€™t sign in, contact support.</div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
